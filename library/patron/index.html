<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>My Library Checkouts</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 700px;
      margin: 40px auto;
      background-color: #f8f9fa;
      color: #333;
    }

    h2 {
      text-align: center;
      color: #2c3e50;
    }

    input[type="text"] {
      width: 100%;
      padding: 10px;
      margin-top: 8px;
      margin-bottom: 12px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }

    button {
      padding: 10px 16px;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    button:hover {
      background-color: #0056b3;
    }

    .checkout {
      background-color: #fff;
      border: 1px solid #ddd;
      border-radius: 6px;
      padding: 12px;
      margin-bottom: 16px;
    }

    .status {
      margin-top: 6px;
      font-size: 0.9em;
    }

    .green { color: green; }
    .red { color: red; }
  </style>
</head>
<body>

<h2>üìö My Library Checkouts</h2>

<label>Enter Library Card Number:</label>
<input type="text" id="borrowerCode" placeholder="e.g., 123456" />
<button onclick="loadMyCheckouts()">View My Checkouts</button>

<div id="results" style="margin-top: 24px;"></div>

<script>
function formatDate(dateString) {
  const date = new Date(dateString);
  return date.toLocaleDateString(undefined, {
    year: 'numeric', month: 'long', day: 'numeric'
  });
}

function loadMyCheckouts() {
  const borrowerCode = document.getElementById("borrowerCode").value.trim();
  const results = document.getElementById("results");
  results.innerHTML = "";

  const borrowers = JSON.parse(localStorage.getItem("borrowerDB")) || {};
  const checkouts = JSON.parse(localStorage.getItem("checkoutLog")) || [];

  if (!borrowers[borrowerCode]) {
    results.innerHTML = `<p class="red">‚ùå Borrower not found.</p>`;
    return;
  }

  const patronName = borrowers[borrowerCode];
  const active = checkouts.filter(c => c.borrowerCode === borrowerCode && !c.checkedIn);

  if (active.length === 0) {
    results.innerHTML = `<p>‚úÖ Hello <strong>${patronName}</strong>, you have no items checked out.</p>`;
    return;
  }

  let html = `<h3>Hello <strong>${patronName}</strong>, here are your current checkouts:</h3>`;

  active.forEach((item, index) => {
    html += `
      <div class="checkout">
        <div><strong>Title:</strong> ${item.title}</div>
        <div><strong>Author:</strong> ${item.author}</div>
        <div><strong>Due Date:</strong> <span id="due-${index}">${formatDate(item.dueDate)}</span></div>
        <button onclick="renew('${item.barcode}', '${item.borrowerCode}', ${index})">üîÅ Renew</button>
        <div class="status" id="status-${index}"></div>
      </div>
    `;
  });

  results.innerHTML = html;
}

function renew(barcode, borrowerCode, index) {
  const checkouts = JSON.parse(localStorage.getItem("checkoutLog")) || [];

  const record = checkouts.find(c => c.barcode === barcode && c.borrowerCode === borrowerCode && !c.checkedIn);
  const status = document.getElementById(`status-${index}`);

  if (!record) {
    status.innerHTML = `<span class="red">‚ùå Not found or already returned.</span>`;
    return;
  }

  const due = new Date(record.dueDate);
  due.setDate(due.getDate() + 14);
  record.dueDate = due.toISOString();

  localStorage.setItem("checkoutLog", JSON.stringify(checkouts));
  document.getElementById(`due-${index}`).textContent = formatDate(record.dueDate);
  status.innerHTML = `<span class="green">‚úÖ Renewed. New due date: ${formatDate(record.dueDate)}</span>`;
}
</script>

</body>
</html>
